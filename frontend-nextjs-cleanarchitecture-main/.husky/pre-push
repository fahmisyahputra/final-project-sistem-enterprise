#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Get the current branch name
branch=$(git symbolic-ref --short HEAD 2>/dev/null)

# Protected branches
protected_branches=("main" "master")

# Check if pushing to a protected branch
for protected in "${protected_branches[@]}"; do
  if [ "$branch" = "$protected" ]; then
    echo ""
    echo "=============================================="
    echo "  WARNING: Direct push to '$branch' blocked!"
    echo "=============================================="
    echo ""
    echo "  Direct pushes to the '$branch' branch are not allowed."
    echo "  Please use a feature branch and create a Pull Request."
    echo ""
    echo "  Steps to follow:"
    echo "  1. Create a new branch: git checkout -b feature/your-feature"
    echo "  2. Commit your changes: git commit -m 'your message'"
    echo "  3. Push to your branch: git push origin feature/your-feature"
    echo "  4. Create a Pull Request on GitLab/GitHub"
    echo ""
    echo "  To bypass this check (NOT RECOMMENDED), use:"
    echo "  git push --no-verify"
    echo ""
    echo "=============================================="
    exit 1
  fi
done

# Run linting before push
echo "Running pre-push checks..."
pnpm lint
